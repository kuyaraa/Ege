{% include 'header.html' %}

<h2>Административная панель</h2>

<!-- Пользователи -->
<section>
    <h3>Пользователи</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Имя</th>
                <th>Email</th>
                <th>Роль</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.id }}</td>
                <td>{{ user.name }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.role }}</td>
                <td>
                    <button class="btn btn-sm btn-primary" data-toggle="modal" data-target="#editUserModal{{ user.id }}">
                        Редактировать
                    </button>
                    <form method="POST" action="{{ url_for('delete_user', user_id=user.id) }}" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-danger">Удалить</button>
                    </form>
                </td>
            </tr>

            <!-- Модальное окно редактирования пользователя -->
            <div class="modal fade" id="editUserModal{{ user.id }}" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <form method="POST" action="{{ url_for('edit_user') }}">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Редактировать пользователя</h5>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" name="user_id" value="{{ user.id }}">
                                <div class="form-group">
                                    <label>Имя:</label>
                                    <input type="text" class="form-control" name="name" value="{{ user.name }}" required>
                                </div>
                                <div class="form-group">
                                    <label>Email:</label>
                                    <input type="email" class="form-control" name="email" value="{{ user.email }}" required>
                                </div>
                                <div class="form-group">
                                    <label>Роль:</label>
                                    <select class="form-control" name="role">
                                        <option value="user" {% if user.role == 'user' %}selected{% endif %}>Пользователь</option>
                                        <option value="admin" {% if user.role == 'admin' %}selected{% endif %}>Администратор</option>
                                    </select>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary">Сохранить изменения</button>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            {% endfor %}
        </tbody>
    </table>
</section>

<!-- Предметы (ЕГЭ) -->
<section>
    <h3>Предметы (ЕГЭ)</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Название</th>
                <th>Описание</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for subject in subjects %}
            <tr>
                <td>{{ subject.id }}</td>
                <td>{{ subject.title }}</td>
                <td>{{ subject.description }}</td>
                <td>
                    <button class="btn btn-sm btn-primary" data-toggle="modal" data-target="#editSubjectModal{{ subject.id }}">
                        Редактировать
                    </button>
                    <form method="POST" action="{{ url_for('delete_subject', subject_id=subject.id) }}" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-danger">Удалить</button>
                    </form>
                </td>
            </tr>

            <!-- Модальное окно редактирования предмета -->
            <div class="modal fade" id="editSubjectModal{{ subject.id }}" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <form method="POST" action="{{ url_for('edit_subject') }}">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Редактировать предмет</h5>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" name="subject_id" value="{{ subject.id }}">
                                <div class="form-group">
                                    <label>Название:</label>
                                    <input type="text" class="form-control" name="title" value="{{ subject.title }}" required>
                                </div>
                                <div class="form-group">
                                    <label>Описание:</label>
                                    <textarea class="form-control" name="description" required>{{ subject.description }}</textarea>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary">Сохранить изменения</button>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            {% endfor %}
        </tbody>
    </table>
</section>

<!-- Задания -->
<section>
    <h3>Задания</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Название</th>
                <th>Тип</th>
                <th>Предмет</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for exercise in exercises %}
            <tr>
                <td>{{ exercise.id }}</td>
                <td>{{ exercise.title }}</td>
                <td>{{ exercise.type }}</td>
                <td>{{ exercise.subject_id }}</td>
                <td>
                    <button class="btn btn-sm btn-primary" data-toggle="modal" data-target="#editExerciseModal{{ exercise.id }}">
                        Редактировать
                    </button>
                    <form method="POST" action="{{ url_for('delete_exercise', exercise_id=exercise.id) }}" style="display:inline;">
                        <button type="submit" class="btn btn-sm btn-danger">Удалить</button>
                    </form>
                </td>
            </tr>

            <!-- Модальное окно редактирования задания -->
            <div class="modal fade" id="editExerciseModal{{ exercise.id }}" tabindex="-1" role="dialog">
                <div class="modal-dialog" role="document">
                    <form method="POST" action="{{ url_for('edit_exercise') }}">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Редактировать задание</h5>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body">
                                <input type="hidden" name="exercise_id" value="{{ exercise.id }}">
                                <div class="form-group">
                                    <label>Название:</label>
                                    <input type="text" class="form-control" name="title" value="{{ exercise.title }}" required>
                                </div>
                                <div class="form-group">
                                    <label>Описание:</label>
                                    <textarea class="form-control" name="description" required>{{ exercise.description }}</textarea>
                                </div>
                                <div class="form-group">
                                    <label>Тип:</label>
                                    <select class="form-control" name="type">
                                        <option value="theory" {% if exercise.type == 'theory' %}selected{% endif %}>Теория</option>
                                        <option value="practice" {% if exercise.type == 'practice' %}selected{% endif %}>Практика</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>ID предмета:</label>
                                    <input type="number" class="form-control" name="subject_id" value="{{ exercise.subject_id }}" required>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary">Сохранить изменения</button>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            {% endfor %}
        </tbody>
    </table>
</section>

{% include 'footer.html' %}
